<%= form_for(@alloc) do |f| %>
    <% if @alloc.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@alloc.errors.count, "error") %> prohibited this item from being saved:</h2>

          <ul>
            <% @alloc.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>


    <div class="row">
        <div class="col-xs-12 col-sm-2 col-md-2">
            <div class="form-group">
                <label for="estado_aic">Estado de la rep√∫blica:</label>
                <select name="estado_aic" id="estado_aic" class="form-control">
                    <% sta = State.order(:estado) %>
                    <% sta.each do |st| %>
                        <option value="<%=st.id%>"><%=st.estado%></option>
                    <% end %>
                </select>
            </div>


            <div class="form-group">
                <label for="municipio_aic">Municipio:</label>
                <select name="municipio_aic" id="municipio_aic" class="form-control">


                </select>

            </div>
            <div class="form-group">
                <label for="localidad_aic">Municipio:</label>
                <select name="localidad_aic" id="localidad_aic" class="form-control">


                </select>

            </div>


            <div class="form-group">
                <label for="necesidades-aic">Necesidades del municipio por sede:</label>
                <select name="necesidades-aic" id="necesidades-aic" class="form-control">

                    <% act = Activity.order(:venue_locality_id) %>
                    <% act.each do |vl| %>
                        <option><%=vl.necesidad%></option>
                    <% end %>
                </select>

            </div>

            <div class="form-group">
              <table class="table table-hover">
                <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Apellido Paterno</th>
                  <th>Municipio</th>
                  <th>Estado</th>
                  <th>Opciones</th>
                </tr>
                </thead>
                <tbody id="personas_aic">

                </tbody>
              </table>

             </div>



        </div>
    </div>

<% end %>


<script>


    $(document).ready(function() {
        $("#estado_aic").change(function () {
            var idEstado = $("#estado_aic option:selected").val();
            $('#municipio_aic').empty()
            $.getJSON("http://localhost:3000/api/consulta_municipios/" + idEstado, function (data) {


                var vals = [];
                $.each(data, function (i, item) {
                    vals = item;
                });
                $.each(vals, function (i, item) {
                    html = "<option value='" + item.id + "'>" + item.municipio + "</option>"
                    $('#municipio_aic').append(html)
                });


            })

            $('#personas_aic').empty()
            $.getJSON("http://localhost:3000/api/consulta_personas_asignadas/" + idEstado, function (data) {


                var vals = [];
                $.each(data, function (i, item) {
                    html = "<tr><td>"+item.id+"</td><td>"+item.a_paterno+"</td><td>"+item.localidad+"</td><td>"+item.estado+"</td>"+"<td><input type='button' class='asignar' id='"+item.id+"' value='Enviar Personas'/></td>"+"</tr>"
                    $('#personas_aic').append(html)
                });

            })


        });

        $("#municipio_aic").change(function(){
            console.log('hola')
            var idLocalidad = $("#municipio_aic option:selected").val();
            $('#localidad_aic').empty()
            $.getJSON("http://localhost:3000/api/consulta_localidades/"+ idLocalidad, function(data) {


                var vals = [];
                $.each(data, function(i, item) {
                    vals =item;
                });
                $.each(vals, function(i, item) {
                    html = "<option value='"+item.id+"'>"+ item.localidad +"</option>"
                    $('#localidad_aic').append(html)
                });


            })

        });

        $(".asignar").click(function(){
            console.log("hola")
        });
    });




</script>

